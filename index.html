<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>红1合成器</title>
	</head>
	<body>
		
		
		请上传图片：<input type="file" id="up-button"/>
		
		请输入数字：<input type="text" id="num" value="1"/>
		<canvas id="cv" width="400" height="400">
			不支持canvas
		</canvas>
		
		生成:<input onclick="saveAsLocalImage()" type="button" value="点击后保存下面图片"/>
		
		<img id="imgBox"/>
		
	</body>
	
	
	<script type="text/javascript" charset="utf-8">
	
		
		var cv = document.getElementById('cv');
		var ctx = cv.getContext('2d');
		var fileBtn = document.getElementById("up-button");
		var numBox = document.getElementById('num');
		var imgBox = document.getElementById('imgBox');
		
		var img = new Image();
		img.src = 'a.jpg';
		img.onload = init;
		fileBtn.onchange = getImg;
		
	
	
		function init(){
			var num = numBox.value;
		  	cv.width = img.width;
    		cv.height = img.height;
			ctx.drawImage(img,0,0);
			
			r = (cv.width<cv.height?cv.width:cv.height)/4;
			
			
			ctx.beginPath(); 
			ctx.arc(cv.width-r, r, r, 0, Math.PI*2, true); 
			ctx.fillStyle = "#FF0000"; 
			ctx.fill();
			
			
			ctx.fillStyle = "#ffffff"; 
			ctx.font=r/2+"px "+"Arial";
			console.log(ctx.font);
			ctx.fillText(num, cv.width-6*r/5, 6*r/5); 
			
			
			
			var red = convertCanvasToImage(cv);
			imgBox.src = red;
			
		}
			
		function getImg(file) {
		    var reader = new FileReader();
		    reader.readAsDataURL(fileBtn.files[0]);
		    reader.onload = function () {
		        img.src = reader.result;
		    }
		}
		

		    function saveAsLocalImage () {
            	
        		var image = cv.toDataURL("image/png");//.replace("image/png", "image/octet-stream"); 
        		//window.location.href=image; 
        		imgBox.width=cv.width;
        		imgBox.height=cv.height;
        		imgBox.src=image;
        	}
		
		
		
		
		
	</script>
</html>
